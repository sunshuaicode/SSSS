<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
			<!-- Bootstrap Styles-->
    <link href="../css/bootstrap.min.css" rel="stylesheet" />
     <!-- FontAwesome Styles-->
    <link href="../css/font-awesome.css" rel="stylesheet" />
        <!-- Custom Styles-->
    <link href="../css/custom-styles.css" rel="stylesheet" />
	</head>
	<body>
		<div class="context">
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">添加课程</button>
			<button type="button" class="btn btn-danger" id="delBench">删除选中</button>
			
			<table class="table">
			  <thead>
			    <tr>
			      <th width="1%"><input name="allChoose" type="checkbox"/></th>
			      <th >编号</th>
			      <th >课程名</th>
			      <th >操作</th>
			    </tr>
			  </thead>
			  <tbody>
			  </tbody>
			</table>

		</div>
		
		<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">添加课程</h4>
            </div>
            <div class="modal-body">
            	<input style="border: #FFFFff;width: 100%;" class="courseName" type="text" placeholder="输入课程名"/>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary sub_btn">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
	
	<script src="../js/jquery.min.js"></script>
      <!-- Bootstrap Js -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- Metis Menu Js -->
    <!-- <script src="../js/jquery.metisMenu.js"></script> -->
      <!-- Custom Js -->
   <!-- <script src="../js/custom-scripts.js"></script>-->
    <script>
    	$(document).ready(function(){
    		$("#delBench").click(function(){
    			var cond = "";
    			$(":input[type='checkbox'][name='choose']:checked").parent().each(function(i){
    				cond+=$(this).siblings().eq(1).text();
    				cond+=",";
    			});
    			if(""!=cond){
    				cond = cond.substring(0, cond.length - 1);
    			}
    			$.post("../course/delCourse",{cond:cond},
  					   function(msg){
      			 if(msg=="ok"){
      				 alert("删除成功")
      				window.location.reload();
      					 
      			 } 
      			 }
     			)
    		})
    		//全选复选框的点击事件处理函数
    		$(":input[type='checkbox'][name='allChoose']").click(function() {
    			$(":input[type='checkbox'][name='choose']").prop("checked", $(this).prop("checked"));
    		});
    		
    		//单个复选框的点击事件处理
    		$("tbody").on("click", ":input[type='checkbox'][name='choose']", function(){
    			if($(this).is(":checked")) {
    				var boxNum = $(":input[type='checkbox'][name='choose']").length;
    				var checkedNum = $(":input[type='checkbox'][name='choose']:checked").length;
    				if(checkedNum == boxNum) {
    					$(":input[type='checkbox'][name='allChoose']").prop("checked", true);
    				}
    			} else {
    				$(":input[type='checkbox'][name='allChoose']").prop("checked", false);
    			}
    		});
    		$("body").on("click","a",function(){
    			var con=$(this).parent().siblings().eq(2).text().toString();
    			$.post("../course/delCourse",{cond:con},
 					   function(msg){
     			 if(msg=="ok"){
     				 alert("删除成功")
     				window.location.reload();
     					 
     			 } 
     			 }
    			)
    		})
    		$.post("../course/showCourse",
					   function(msg){
    			 $("tbody").empty();
    			 
                 $.each(msg,function(i){
                 	var trObj = $("<tr>");
                 	var a=i+1;
                 	trObj.append("<td><input name='choose' type=\"checkbox\"/></td>");
                 	trObj.append("<td>"+a+"</td>");
                 	trObj.append("<td>"+msg[i].cName+"</td>");
                 	
                 	trObj.append("<td><a href=\"#\">删除</a></td>");
                 	$("tbody").append(trObj);
                 })
					   },"json"); 
    		
    		$(".sub_btn").click(function(){
    			var cName=$(".courseName").val();
    			$.post("../course/judgeCourseExist", { courseName:cName  },
 					   function(data){
 					     if(data=="y"){
 					    	 alert("课程已存在，请勿重新添加")
 					     }else{
 					    	$.post("../course/addCourse", { courseName:cName  },
 		    					   function(data){
 		    					     if(data=="y"){
 		    					    	 alert("添加成功")
 		    					    	window.location.reload();
 		    					     }else{
 		    					    	 alert("添加失败")
 		    					     }
 		    					   }); 
 					     }
 					   });
    			
    		})
    		
    	})
    </script>
	</body>
</html>
